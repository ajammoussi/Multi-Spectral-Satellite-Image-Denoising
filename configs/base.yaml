# Base Configuration for SatMAE Multi-Spectral Denoiser
# Optimized for NVIDIA RTX 4050 (6GB VRAM)

# Hardware Constraints
device: "cuda"
max_vram_gb: 6
seed: 42

# Data Configuration
data:
  root_dir: "./data/EuroSAT_MS"
  num_bands: 13
  image_size: 192  # Matched to available checkpoint (192x192)
  patch_size: 16  # SatMAE default
  train_split: 0.8
  num_workers: 0  # Set to 0 for Windows compatibility
  pin_memory: true

# Noise Simulation (Realistic sensor characteristics)
noise:
  gaussian_sigma: 0.015  # Moderate thermal/electronic noise
  speckle_sigma: 0.008   # Moderate coherent noise
  dead_band_prob: 0.08   # 8% dead bands
  thermal_noise_scale: 0.005  # Wavelength-dependent thermal noise

# Model Architecture
model:
  encoder:
    name: "satmae_vit_base"
    pretrained_path: "./weights/satmae_pretrain.pth"
    freeze_layers: [0, 1, 2, 3, 4, 5]  # Freeze first 6 blocks (50% params)
    gradient_checkpointing: true
    input_channels: 13
    patch_size: 16
    embed_dim: 768  # Matched to available checkpoint
    depth: 12
    num_heads: 12    # 768 dim / 64 head_dim = 12 heads
  
  decoder:
    architecture: "unet_light"
    channels: [384, 192, 96, 48]  # Scaled for 768 dim encoder
    use_attention: false  # Save VRAM
    output_channels: 13

# Training Optimization
training:
  epochs: 100
  effective_batch_size: 64
  micro_batch_size: 8  # Actual batch on GPU
  gradient_accumulation_steps: 8  # 8 * 8 = 64 effective
  
  optimizer:
    type: "AdamW"
    lr: 1e-4
    weight_decay: 0.05
    betas: [0.9, 0.999]
  
  scheduler:
    type: "CosineAnnealingWarmRestarts"
    T_0: 10
    T_mult: 2
    eta_min: 1e-6
  
  mixed_precision: true  # AMP
  gradient_clip: 1.0
  
  loss:
    mse_weight: 1.0
    ssim_weight: 0.1
    perceptual_weight: 0.0  # Disabled to save memory

# Checkpointing
checkpoint:
  save_every: 5
  keep_top_k: 3
  metric: "val_psnr"  # Higher is better
